<% if !@divide_exist && @last_enter_at && (@last_enter_at < message.created_at) && message.user_id != current_user.id %>
  <% @divide_exist = true %>
  <div class='flex text-right divide'>
    <span class='h-0 border-b-0 border-t-2 block flex-grow border-red-600 my-auto'></span>
    <span class="pl-3">new</span>
  </div>
<% end%>
<div class="messages_child">
  <div class="flex justify-between hover:bg-gray-100 relative txtcolumn mt-2 mb-2" data-controller="emoji" data-emoji-id =<%= message.id %>>
    <div class="txt flex pl-5">
      <div class="author font-bold mr-2">
        <%= message.user.nickname %>
      </div>
      <div class="share-msg flex-col">
        <div class="createtime mr-2">
          <%= message.created_at.strftime("%I:%M") %>
        </div>
        <div class="content">
            <%= raw(message.content) %>
        </div>
        <div class="file">
          <% if message.attachfiles.empty? != true %>
            <% message.attachfiles.each do |file|%>
              <%= image_tag file.document(:small).url if file.document.mime_type.include? "image" %>
              <%= link_to file.document.metadata["filename"], file.document.download_url(host: "http://localhost:3000/"), download:"" unless file.document.mime_type.include? "image"%>
            <% end %>
          <% end %>
        </div>
          <% if message.share_message_id.present? %>
          <div class="m-2 border-l-4 border-gray-600">
            <div class="ml-2 font-bold"> <%= message.share_message.user.nickname %> </div>
            <div class="ml-2"> <%= raw(message.share_message.content) %> </div>
          </div> 
        <% end %>       
        <div class="reaction-emoji" data-target="emoji.reaction">
          <div id="message-reaction-<%= message.id %>" class="flex added-emoji">
            <%= render './shared/reaction', message: message %>
           </div>
        </div>
      </div>
    </div>
    <div class="react-bar absolute right-0  mr-10 -mt-3 flex">
      <button class="emoji-trigger" data-action="click-> emoji#click" data-id=<%= message.id %>>Emoji</button>
      <% if controller_name != "directmsgs"%>
      <button class= "share-btn btn btn-blue" data-id="<%= message.id %>">share</button>
      <% end %>
    </div>
  </div>
</div>


